# üöÄ Guia de Instala√ß√£o - Sistema de Documenta√ß√£o T√©cnica

## üìã Pr√©-requisitos

- **Node.js** >= 18.0.0
- **MongoDB** (local ou remoto)
- **Git** (opcional)

---

## üîß Instala√ß√£o

### 1Ô∏è‚É£ Instalar Depend√™ncias

```bash
npm install
```

### 2Ô∏è‚É£ Configurar MongoDB

#### Op√ß√£o A: MongoDB Local (Padr√£o)
O sistema j√° est√° configurado para MongoDB local:
```
mongodb://127.0.0.1:27017/infra_docs
```

#### Op√ß√£o B: MongoDB Remoto (Atlas ou outro)
Edite o arquivo `src/config/dbConnect.js`:

```javascript
const MONGO_URI = process.env.MONGO_URI || 'sua_connection_string_aqui';
```

Ou use vari√°vel de ambiente:
```bash
export MONGO_URI="mongodb+srv://usuario:senha@cluster.mongodb.net/infra_docs"
```

---

## üåê Configura√ß√£o para Acesso Externo

### 1Ô∏è‚É£ O arquivo `app.js` j√° est√° configurado para acesso externo:

```javascript
const HOST = '0.0.0.0'; // Aceita conex√µes de qualquer IP
const PORT = 1100;
```

### 2Ô∏è‚É£ Liberar Porta no Firewall (Windows Server)

#### Via PowerShell (Administrador):
```powershell
New-NetFirewallRule -DisplayName "Documentacao Infinitibank" -Direction Inbound -LocalPort 1100 -Protocol TCP -Action Allow
```

#### Via Interface Gr√°fica:
1. Abra `Windows Defender Firewall` > `Configura√ß√µes Avan√ßadas`
2. Clique em `Regras de Entrada` > `Nova Regra`
3. Tipo: **Porta**
4. Protocolo: **TCP**, Porta: **1100**
5. A√ß√£o: **Permitir conex√£o**
6. Nome: **Documentacao Infinitibank**

### 3Ô∏è‚É£ Configurar DNS (Opcional)

Se quiser acessar por nome em vez de IP:

**No Domain Controller (SRVDC01)**:
1. Abra `DNS Manager`
2. Zona: `infinitibank.corp`
3. Criar novo registro A:
   - Nome: `docs`
   - IP: `192.168.10.201` (IP do SRVBASE01)
4. Acesso: `http://docs.infinitibank.corp:1100`

---

## ‚ñ∂Ô∏è Iniciar o Sistema

### Modo Produ√ß√£o:
```bash
npm start
```

### Modo Desenvolvimento (com auto-reload):
```bash
npm run dev
```

### Rodar em Background (PM2 - Recomendado):
```bash
# Instalar PM2 globalmente
npm install -g pm2

# Iniciar aplica√ß√£o
pm2 start app.js --name "documentacao-infinitibank"

# Ver logs
pm2 logs documentacao-infinitibank

# Reiniciar
pm2 restart documentacao-infinitibank

# Configurar para iniciar com o sistema
pm2 startup
pm2 save
```

---

## üîó Acessar o Sistema

### Localmente (no servidor):
```
http://localhost:1100
```

### Na rede interna:
```
http://192.168.10.201:1100
```

### Por nome (se configurou DNS):
```
http://docs.infinitibank.corp:1100
```

---

## üìä Estrutura de Dados (JSON)

### Exemplo Completo de Documento:

```json
{
  "tituloDocumento": "Documenta√ß√£o RACK001 - F√≠sico",
  "identificador": "RACK001-FISICO",
  "secoes": [
    {
      "tituloSecao": "Vis√£o Geral",
      "subtituloSecao": "Infraestrutura Principal",
      "tipoConteudo": "infoGeral",
      "conteudo": {
        "textoBruto": "Rack principal contendo firewall, switch e servidores.",
        "detalhes": [
          {"rotulo": "Localiza√ß√£o", "valor": "Datacenter Principal"},
          {"rotulo": "Rack ID", "valor": "RACK001"}
        ]
      }
    },
    {
      "tituloSecao": "Firewall pfSense",
      "tipoConteudo": "infoGeral",
      "conteudo": {
        "detalhes": [
          {"rotulo": "IP", "valor": "192.168.10.1"},
          {"rotulo": "MAC", "valor": "78:9A:18:30:20:3D"}
        ]
      },
      "secoesAninhadas": [
        {
          "tituloSecao": "Credenciais de Acesso",
          "tipoConteudo": "credenciais",
          "conteudo": {
            "textoBruto": "Login: admin\nSenha: ,~~taE3J\\UVwD2nX)w\nURL: https://infinitibank.bugbusters.me:40443"
          }
        }
      ]
    },
    {
      "tituloSecao": "Mapa de Rede",
      "tipoConteudo": "mapaRede",
      "conteudo": {
        "textoBruto": "Internet\n  |\n[pfSense] - 192.168.10.1\n  |\n[Switch UniFi]\n  |\n  ‚îú‚îÄ SRVBASE01 - 192.168.10.201\n  ‚îî‚îÄ SRVDC01 - 192.168.10.200"
      }
    }
  ]
}
```

### Tipos de Conte√∫do Dispon√≠veis:

| Tipo | Uso | Campos |
|------|-----|--------|
| `infoGeral` | Informa√ß√µes gerais | `textoBruto`, `detalhes[]` |
| `credenciais` | Senhas e acessos | `textoBruto` |
| `mapaRede` | Diagramas ASCII | `textoBruto` |
| `blocoCodigo` | C√≥digo/comandos | `textoBruto` |
| `imagem` | Imagens/diagramas | `urlImagem`, `altImagem`, `textoBruto` |

---

## üìÑ Gerar PDF

### M√©todo 1: Navegador
1. Acesse um documento
2. Clique em **"Imprimir/PDF"**
3. Selecione **"Salvar como PDF"**

### M√©todo 2: Ctrl+P
1. Abra qualquer documento
2. Pressione `Ctrl + P`
3. Escolha destino como PDF

**üí° Dica**: O layout foi otimizado para impress√£o em A4 com margens de 2cm.

---

## üîí Seguran√ßa

### Recomenda√ß√µes:

1. **Altere as senhas padr√£o** dos documentos de exemplo
2. **Use HTTPS** em produ√ß√£o (configure proxy reverso)
3. **Restrinja acesso** via firewall para IPs internos apenas
4. **Fa√ßa backups** regulares do MongoDB
5. **Monitore logs** do sistema

### Backup MongoDB:

```bash
# Backup
mongodump --db infra_docs --out /backup/$(date +%Y%m%d)

# Restore
mongorestore --db infra_docs /backup/20250403/infra_docs
```

---

## üêõ Solu√ß√£o de Problemas

### Erro: "Cannot connect to MongoDB"
- Verifique se MongoDB est√° rodando: `net start MongoDB` (Windows)
- Teste conex√£o: `mongo --eval "db.version()"`

### Erro: "EADDRINUSE" (porta em uso)
- Altere a porta no `app.js`: `const PORT = 3000;`
- Ou finalize processo: `netstat -ano | findstr :1100`

### P√°gina n√£o carrega externamente
- Verifique firewall Windows
- Teste ping no servidor
- Confirme que HOST est√° como `0.0.0.0`

### JSON inv√°lido ao salvar
- Use validador online: https://jsonlint.com/
- Verifique v√≠rgulas e aspas
- Escape caracteres especiais: `\n` para quebra de linha

---

## üìû Suporte

Para problemas ou d√∫vidas:
- **Logs do servidor**: `pm2 logs` ou console do Node
- **Logs do MongoDB**: `C:\Program Files\MongoDB\Server\X.X\log\`
- **Documenta√ß√£o MongoDB**: https://docs.mongodb.com/

---

## üéØ Pr√≥ximos Passos

1. ‚úÖ Importar documenta√ß√£o existente do PDF fornecido
2. ‚úÖ Configurar backup autom√°tico
3. ‚úÖ Configurar HTTPS (opcional)
4. ‚úÖ Criar usu√°rios com diferentes permiss√µes (futuro)
5. ‚úÖ Integrar com Active Directory (futuro)

---

**Vers√£o**: 2.0.0  
**√öltima Atualiza√ß√£o**: Outubro 2025  
**Desenvolvido para**: Infinitibank